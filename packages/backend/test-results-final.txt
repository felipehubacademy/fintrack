ğŸ§ª TESTES ABRANGENTES DO ZUL ASSISTANT

================================================================================

ğŸ“ Teste 1: Perfume â†’ Beleza (nÃ£o Impostos)
   Mensagem: "gastei 250 em perfume no crÃ©dito Latam"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "gastei 250 em perfume no crÃ©dito Latam"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'gastei 250 em perfume no crÃ©dito Latam'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ’¾ [GPT-4] Salvando no histÃ³rico: user="gastei 250 em perfume no crÃ©dito Latam", assistant="Qual foi o nÃºmero de parcelas?"
ğŸ’¾ [saveToHistory] Phone: 5511999888777
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ’¾ [saveToHistory] HistÃ³rico atual: 0 mensagens
ğŸ’¾ [saveToHistory] HistÃ³rico apÃ³s push: 2 mensagens
ğŸ’¾ [saveToHistory] Upsert result: {"error":null,"data":null,"count":null,"status":200,"statusText":"OK"}
ğŸ’¾ [GPT-4] HistÃ³rico salvo com 2 mensagens
   Resposta: "Qual foi o nÃºmero de parcelas?"
   ValidaÃ§Ãµes: Save esperado: âŒ, Categoria "beleza": âŒ, NÃƒO contÃ©m proibido: âœ…
   Resultado: âŒ FALHOU

ğŸ“ Teste 2: Torradeira â†’ Casa (nÃ£o Contas)
   Mensagem: "comprei uma torradeira por 139 no crÃ©dito C6"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "comprei uma torradeira por 139 no crÃ©dito C6"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'comprei uma torradeira por 139 no crÃ©dito C6'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 139,
  description: 'torradeira',
  payment_method: 'credit_card',
  responsible: 'eu',
  card_name: 'C6'
}
âš™ï¸ [SAVE] Parcelas nÃ£o fornecidas, assumindo 1 (Ã  vista) automaticamente
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 139,
  "description": "Torradeira",
  "date": "2025-11-19",
  "category": "Impostos",
  "category_id": "b46aa62b-03d7-4ff3-a33e-483b43a2a635",
  "owner": "Felipe Xavier",
  "cost_center_id": "6b44926c-1b79-4cac-9a82-9f0bc7f15c9e",
  "payment_method": "credit_card",
  "card_id": "4ff726f6-0fee-4067-9ea8-e19cb38e49d8",
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": false,
  "confirmed_at": "2025-11-20T02:10:38.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604638331"
}
âœ… Despesa salva: 1355
âœ¨ [GPT] Mensagem contextual gerada: Impostos pagos, agora Ã© sÃ³ torrar na sua torradeira! ğŸ”¥
  -> Result for save_expense: {
  success: true,
  message: 'Pronto! âœ…\n' +
    'R$ 139,00 - Torradeira\n' +
    'Impostos\n' +
    'CrÃ©dito â€¢ C6\n' +
    'Felipe Xavier\n' +
    'Hoje\n' +
    '\n' +
    'Impostos pagos, agora Ã© sÃ³ torrar na sua torradeira! ğŸ”¥',
  expense_id: 1355
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Pronto! âœ…
R$ 139,00 - Torradeira
Impostos
CrÃ©dito â€¢ C6
Felipe Xavier
Hoje

Impostos pagos, agora Ã© sÃ³ torrar na sua torradeira! ğŸ”¥"
   ValidaÃ§Ãµes: Save esperado: âœ…, Categoria "casa": âŒ, NÃƒO contÃ©m proibido: âœ…
   Resultado: âŒ FALHOU

ğŸ“ Teste 3: SacolÃ£o â†’ Mercado (nÃ£o Outros)
   Mensagem: "gastamos 50 no sacolÃ£o no dinheiro"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "gastamos 50 no sacolÃ£o no dinheiro"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'gastamos 50 no sacolÃ£o no dinheiro'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 50,
  description: 'sacolÃ£o',
  payment_method: 'cash',
  responsible: 'compartilhado'
}
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 50,
  "description": "SacolÃ£o",
  "date": "2025-11-19",
  "category": "AlimentaÃ§Ã£o",
  "category_id": "7f0ce431-63f4-48e0-ac39-27179ecc72e4",
  "owner": "FamÃ­lia Xavier",
  "cost_center_id": null,
  "payment_method": "cash",
  "card_id": null,
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": true,
  "confirmed_at": "2025-11-20T02:10:42.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604642459"
}
âœ… Despesa salva: 1356
âœ¨ [GPT] Mensagem contextual gerada: SacolÃ£o na mÃ£o, saÃºde na mesa! ğŸ¥¦
  -> Result for save_expense: {
  success: true,
  message: 'Beleza, anotei! âœ…\n' +
    'R$ 50,00 - SacolÃ£o\n' +
    'AlimentaÃ§Ã£o\n' +
    'Dinheiro\n' +
    'FamÃ­lia Xavier\n' +
    'Hoje\n' +
    '\n' +
    'SacolÃ£o na mÃ£o, saÃºde na mesa! ğŸ¥¦',
  expense_id: 1356
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Beleza, anotei! âœ…
R$ 50,00 - SacolÃ£o
AlimentaÃ§Ã£o
Dinheiro
FamÃ­lia Xavier
Hoje

SacolÃ£o na mÃ£o, saÃºde na mesa! ğŸ¥¦"
   ValidaÃ§Ãµes: Save esperado: âœ…, Categoria "mercado": âŒ, NÃƒO contÃ©m proibido: âœ…
   Resultado: âŒ FALHOU

ğŸ“ Teste 4: Impostos â†’ Impostos (correto)
   Mensagem: "paguei 106,17 impostos no crÃ©dito Roxinho"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "paguei 106,17 impostos no crÃ©dito Roxinho"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'paguei 106,17 impostos no crÃ©dito Roxinho'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 106.17,
  description: 'impostos',
  payment_method: 'credit_card',
  responsible: 'eu',
  card_name: 'Roxinho',
  installments: 1
}
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 106.17,
  "description": "Impostos",
  "date": "2025-11-19",
  "category": "Impostos",
  "category_id": "b46aa62b-03d7-4ff3-a33e-483b43a2a635",
  "owner": "Felipe Xavier",
  "cost_center_id": "6b44926c-1b79-4cac-9a82-9f0bc7f15c9e",
  "payment_method": "credit_card",
  "card_id": "0c8a77e6-e822-4fd0-a426-883366f1de7b",
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": false,
  "confirmed_at": "2025-11-20T02:10:45.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604645742"
}
âœ… Despesa salva: 1357
âœ¨ [GPT] Mensagem contextual gerada: Impostos pagos, rumo ao progresso! ğŸ’ª
  -> Result for save_expense: {
  success: true,
  message: 'Joia, tÃ¡ salvo! âœ…\n' +
    'R$ 106,17 - Impostos\n' +
    'Impostos\n' +
    'CrÃ©dito â€¢ Roxinho\n' +
    'Felipe Xavier\n' +
    'Hoje\n' +
    '\n' +
    'Impostos pagos, rumo ao progresso! ğŸ’ª',
  expense_id: 1357
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Joia, tÃ¡ salvo! âœ…
R$ 106,17 - Impostos
Impostos
CrÃ©dito â€¢ Roxinho
Felipe Xavier
Hoje

Impostos pagos, rumo ao progresso! ğŸ’ª"
   ValidaÃ§Ãµes: Save esperado: âœ…, Categoria "impostos": âœ…, NÃƒO contÃ©m proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 5: Gasto do Felipe â†’ responsÃ¡vel=Felipe
   Mensagem: "gasto do Felipe, 150 mercado no crÃ©dito Latam"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "gasto do Felipe, 150 mercado no crÃ©dito Latam"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'gasto do Felipe, 150 mercado no crÃ©dito Latam'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 150,
  description: 'mercado',
  payment_method: 'credit_card',
  responsible: 'Felipe',
  card_name: 'Latam'
}
âš™ï¸ [SAVE] Parcelas nÃ£o fornecidas, assumindo 1 (Ã  vista) automaticamente
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 150,
  "description": "Mercado",
  "date": "2025-11-19",
  "category": "AlimentaÃ§Ã£o",
  "category_id": "7f0ce431-63f4-48e0-ac39-27179ecc72e4",
  "owner": "Felipe Xavier",
  "cost_center_id": "6b44926c-1b79-4cac-9a82-9f0bc7f15c9e",
  "payment_method": "credit_card",
  "card_id": "eeb7d97a-99a0-4ed5-b7ae-b5d1a2e0735e",
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": false,
  "confirmed_at": "2025-11-20T02:10:49.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604649275"
}
âœ… Despesa salva: 1358
âœ¨ [GPT] Mensagem contextual gerada: Mercado abastecido! Hora de cozinhar delÃ­cias! ğŸ½ï¸
  -> Result for save_expense: {
  success: true,
  message: 'Show, registrei! âœ…\n' +
    'R$ 150,00 - Mercado\n' +
    'AlimentaÃ§Ã£o\n' +
    'CrÃ©dito â€¢ Latam\n' +
    'Felipe Xavier\n' +
    'Hoje\n' +
    '\n' +
    'Mercado abastecido! Hora de cozinhar delÃ­cias! ğŸ½ï¸',
  expense_id: 1358
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Show, registrei! âœ…
R$ 150,00 - Mercado
AlimentaÃ§Ã£o
CrÃ©dito â€¢ Latam
Felipe Xavier
Hoje

Mercado abastecido! Hora de cozinhar delÃ­cias! ğŸ½ï¸"
   ValidaÃ§Ãµes: Save esperado: âœ…, ResponsÃ¡vel "felipe": âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 6: Gasto da famÃ­lia â†’ compartilhado
   Mensagem: "gasto da famÃ­lia, 200 no supermercado crÃ©dito Roxinho"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "gasto da famÃ­lia, 200 no supermercado crÃ©dito Roxinho"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'gasto da famÃ­lia, 200 no supermercado crÃ©dito Roxi'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 200,
  description: 'supermercado',
  payment_method: 'credit_card',
  responsible: 'compartilhado',
  card_name: 'Roxinho'
}
âš™ï¸ [SAVE] Parcelas nÃ£o fornecidas, assumindo 1 (Ã  vista) automaticamente
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 200,
  "description": "Supermercado",
  "date": "2025-11-19",
  "category": "AlimentaÃ§Ã£o",
  "category_id": "7f0ce431-63f4-48e0-ac39-27179ecc72e4",
  "owner": "FamÃ­lia Xavier",
  "cost_center_id": null,
  "payment_method": "credit_card",
  "card_id": "0c8a77e6-e822-4fd0-a426-883366f1de7b",
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": true,
  "confirmed_at": "2025-11-20T02:10:52.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604652578"
}
âœ… Despesa salva: 1359
âœ¨ [GPT] Mensagem contextual gerada: Compras no mercado feitas! Agora Ã© hora de saborear! ğŸ½ï¸
  -> Result for save_expense: {
  success: true,
  message: 'Pronto! âœ…\n' +
    'R$ 200,00 - Supermercado\n' +
    'AlimentaÃ§Ã£o\n' +
    'CrÃ©dito â€¢ Roxinho\n' +
    'FamÃ­lia Xavier\n' +
    'Hoje\n' +
    '\n' +
    'Compras no mercado feitas! Agora Ã© hora de saborear! ğŸ½ï¸',
  expense_id: 1359
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Pronto! âœ…
R$ 200,00 - Supermercado
AlimentaÃ§Ã£o
CrÃ©dito â€¢ Roxinho
FamÃ­lia Xavier
Hoje

Compras no mercado feitas! Agora Ã© hora de saborear! ğŸ½ï¸"
   ValidaÃ§Ãµes: Save esperado: âœ…, ResponsÃ¡vel "compartilhado": âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 7: Compra da LetÃ­cia â†’ responsÃ¡vel=LetÃ­cia
   Mensagem: "compra da LetÃ­cia, 50 farmÃ¡cia no pix"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "compra da LetÃ­cia, 50 farmÃ¡cia no pix"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'compra da LetÃ­cia, 50 farmÃ¡cia no pix'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 50,
  description: 'farmÃ¡cia',
  payment_method: 'pix',
  responsible: 'LetÃ­cia'
}
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 50,
  "description": "FarmÃ¡cia",
  "date": "2025-11-19",
  "category": "SaÃºde",
  "category_id": "46fce20b-cef3-423b-81a3-6f3c086def53",
  "owner": "LetÃ­cia Wonsowski",
  "cost_center_id": "2c7436af-9ff6-4811-b401-94e0648c4d59",
  "payment_method": "pix",
  "card_id": null,
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": false,
  "confirmed_at": "2025-11-20T02:10:55.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604655484"
}
âœ… Despesa salva: 1360
âœ¨ [GPT] Mensagem contextual gerada: RemÃ©dios na mÃ£o, saÃºde em dia! ğŸ’Š
  -> Result for save_expense: {
  success: true,
  message: 'Beleza, anotei! âœ…\n' +
    'R$ 50,00 - FarmÃ¡cia\n' +
    'SaÃºde\n' +
    'Pix\n' +
    'LetÃ­cia Wonsowski\n' +
    'Hoje\n' +
    '\n' +
    'RemÃ©dios na mÃ£o, saÃºde em dia! ğŸ’Š',
  expense_id: 1360
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Beleza, anotei! âœ…
R$ 50,00 - FarmÃ¡cia
SaÃºde
Pix
LetÃ­cia Wonsowski
Hoje

RemÃ©dios na mÃ£o, saÃºde em dia! ğŸ’Š"
   ValidaÃ§Ãµes: Save esperado: âœ…, ResponsÃ¡vel "letÃ­cia": âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 8: Latam mencionado â†’ crÃ©dito inferido
   Mensagem: "gastei 100 em cafÃ© no Latam"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "gastei 100 em cafÃ© no Latam"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'gastei 100 em cafÃ© no Latam'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 100,
  description: 'cafÃ©',
  payment_method: 'credit_card',
  responsible: 'eu',
  card_name: 'Latam'
}
âš™ï¸ [SAVE] Parcelas nÃ£o fornecidas, assumindo 1 (Ã  vista) automaticamente
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 100,
  "description": "Cafe",
  "date": "2025-11-19",
  "category": "AlimentaÃ§Ã£o",
  "category_id": "7f0ce431-63f4-48e0-ac39-27179ecc72e4",
  "owner": "Felipe Xavier",
  "cost_center_id": "6b44926c-1b79-4cac-9a82-9f0bc7f15c9e",
  "payment_method": "credit_card",
  "card_id": "eeb7d97a-99a0-4ed5-b7ae-b5d1a2e0735e",
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": false,
  "confirmed_at": "2025-11-20T02:10:58.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604658646"
}
âœ… Despesa salva: 1361
âœ¨ [GPT] Mensagem contextual gerada: CafÃ© quentinho para animar seu dia! â˜•
  -> Result for save_expense: {
  success: true,
  message: 'Registrado! âœ…\n' +
    'R$ 100,00 - Cafe\n' +
    'AlimentaÃ§Ã£o\n' +
    'CrÃ©dito â€¢ Latam\n' +
    'Felipe Xavier\n' +
    'Hoje\n' +
    '\n' +
    'CafÃ© quentinho para animar seu dia! â˜•',
  expense_id: 1361
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Registrado! âœ…
R$ 100,00 - Cafe
AlimentaÃ§Ã£o
CrÃ©dito â€¢ Latam
Felipe Xavier
Hoje

CafÃ© quentinho para animar seu dia! â˜•"
   ValidaÃ§Ãµes: Save esperado: âœ…, Pagamento "crÃ©dito": âœ…, CartÃ£o "latam": âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 9: MercadoPago â†’ crÃ©dito automÃ¡tico + 10x
   Mensagem: "compramos uma mÃ¡quina de lavar por 3299 em 10x no MercadoPago"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "compramos uma mÃ¡quina de lavar por 3299 em 10x no MercadoPago"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'compramos uma mÃ¡quina de lavar por 3299 em 10x no '
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 3299,
  description: 'mÃ¡quina de lavar',
  payment_method: 'credit_card',
  responsible: 'compartilhado',
  card_name: 'MercadoPago',
  installments: 10
}
ğŸ’³ [SAVE] Criando parcelas usando RPC create_installments
ğŸ’¾ [SAVE] Chamando RPC create_installments com: {
  p_amount: 3299,
  p_installments: 10,
  p_description: 'Maquina lavar',
  p_date: '2025-11-19',
  p_card_id: '411c12e8-8801-454d-b38b-b337ee11c831',
  p_category_id: 'dde8065c-5a81-436c-9c9e-f8c86da953be',
  p_cost_center_id: null,
  p_owner: 'FamÃ­lia Xavier',
  p_organization_id: '9fad4881-65a9-4e38-ad75-b707ddff473f',
  p_user_id: '7ae77718-a4a2-4a3c-8f99-e537f2c5ff92',
  p_whatsapp_message_id: 'msg_1763604661983'
}
âœ… [SAVE] Parcelas criadas com sucesso. Parent ID: 1362
âœ… [SAVE] Metadados atualizados (source=whatsapp)
âœ… [SAVE] Updated card available_limit: 1602
âœ¨ [GPT] Mensagem contextual gerada: Lavadora nova, casa limpa e vida leve! ğŸ§º
  -> Result for save_expense: {
  success: true,
  message: 'Show, registrei! âœ…\n' +
    'R$ 3.299,00 - Maquina lavar\n' +
    'Outros\n' +
    'CrÃ©dito â€¢ MercadoPago 10x\n' +
    'FamÃ­lia Xavier\n' +
    'Hoje\n' +
    '\n' +
    'Lavadora nova, casa limpa e vida leve! ğŸ§º',
  expense_id: 1362
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Show, registrei! âœ…
R$ 3.299,00 - Maquina lavar
Outros
CrÃ©dito â€¢ MercadoPago 10x
FamÃ­lia Xavier
Hoje

Lavadora nova, casa limpa e vida leve! ğŸ§º"
   ValidaÃ§Ãµes: Save esperado: âœ…, Pagamento "crÃ©dito": âœ…, CartÃ£o "mercadopago": âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 10: "Ã€ vista" â†’ 1 parcela
   Mensagem: "comprei pÃ£o por 11,20 no crÃ©dito C6, Ã  vista"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "comprei pÃ£o por 11,20 no crÃ©dito C6, Ã  vista"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'comprei pÃ£o por 11,20 no crÃ©dito C6, Ã  vista'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 11.2,
  description: 'pÃ£o',
  payment_method: 'credit_card',
  responsible: 'eu',
  card_name: 'C6',
  installments: 1
}
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 11.2,
  "description": "PÃ£o",
  "date": "2025-11-19",
  "category": "AlimentaÃ§Ã£o",
  "category_id": "7f0ce431-63f4-48e0-ac39-27179ecc72e4",
  "owner": "Felipe Xavier",
  "cost_center_id": "6b44926c-1b79-4cac-9a82-9f0bc7f15c9e",
  "payment_method": "credit_card",
  "card_id": "4ff726f6-0fee-4067-9ea8-e19cb38e49d8",
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": false,
  "confirmed_at": "2025-11-20T02:11:06.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604666150"
}
âœ… Despesa salva: 1372
âœ¨ [GPT] Mensagem contextual gerada: PÃ£o quentinho na mesa! Vamos saborear! ğŸ¥–
  -> Result for save_expense: {
  success: true,
  message: 'Anotado! âœ…\n' +
    'R$ 11,20 - PÃ£o\n' +
    'AlimentaÃ§Ã£o\n' +
    'CrÃ©dito â€¢ C6\n' +
    'Felipe Xavier\n' +
    'Hoje\n' +
    '\n' +
    'PÃ£o quentinho na mesa! Vamos saborear! ğŸ¥–',
  expense_id: 1372
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Anotado! âœ…
R$ 11,20 - PÃ£o
AlimentaÃ§Ã£o
CrÃ©dito â€¢ C6
Felipe Xavier
Hoje

PÃ£o quentinho na mesa! Vamos saborear! ğŸ¥–"
   ValidaÃ§Ãµes: Save esperado: âœ…, Parcelas nÃ£o perguntadas: âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 11: "sacolao" â†’ "SacolÃ£o" com acento
   Mensagem: "gastamos 80 no sacolao no dinheiro"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "gastamos 80 no sacolao no dinheiro"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'gastamos 80 no sacolao no dinheiro'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 80,
  description: 'sacolÃ£o',
  payment_method: 'cash',
  responsible: 'compartilhado'
}
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 80,
  "description": "SacolÃ£o",
  "date": "2025-11-19",
  "category": "AlimentaÃ§Ã£o",
  "category_id": "7f0ce431-63f4-48e0-ac39-27179ecc72e4",
  "owner": "FamÃ­lia Xavier",
  "cost_center_id": null,
  "payment_method": "cash",
  "card_id": null,
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": true,
  "confirmed_at": "2025-11-20T02:11:09.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604669474"
}
âœ… Despesa salva: 1373
âœ¨ [GPT] Mensagem contextual gerada: Alimento fresquinho na Ã¡rea! Bom apetite! ğŸ¥¦
  -> Result for save_expense: {
  success: true,
  message: 'Registrado! âœ…\n' +
    'R$ 80,00 - SacolÃ£o\n' +
    'AlimentaÃ§Ã£o\n' +
    'Dinheiro\n' +
    'FamÃ­lia Xavier\n' +
    'Hoje\n' +
    '\n' +
    'Alimento fresquinho na Ã¡rea! Bom apetite! ğŸ¥¦',
  expense_id: 1373
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Registrado! âœ…
R$ 80,00 - SacolÃ£o
AlimentaÃ§Ã£o
Dinheiro
FamÃ­lia Xavier
Hoje

Alimento fresquinho na Ã¡rea! Bom apetite! ğŸ¥¦"
   ValidaÃ§Ãµes: Save esperado: âœ…, DescriÃ§Ã£o "sacolÃ£o": âœ…, NÃƒO contÃ©m proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 12: "hoje gastei" â†’ responsÃ¡vel=eu
   Mensagem: "hoje gastei 50 no mercado no dÃ©bito"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "hoje gastei 50 no mercado no dÃ©bito"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ” [isNewConversationStart] Detectado inÃ­cio de nova conversa: {
  hasActionVerb: true,
  hasValue: true,
  isNotShortResponse: true,
  message: 'hoje gastei 50 no mercado no dÃ©bito'
}
ğŸ”„ [ZUL] Detectada nova conversa - limpando histÃ³rico anterior
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ“ [extractCollectedInfo] Analisando 0 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: ""
  âš ï¸ Valor NÃƒO encontrado
  âš ï¸ DescriÃ§Ã£o NÃƒO encontrada
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 0 mensagens
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 2
ğŸ’¾ [GPT-4] Salvando no histÃ³rico: user="hoje gastei 50 no mercado no dÃ©bito", assistant="Qual cartÃ£o vocÃª usou para o pagamento?"
ğŸ’¾ [saveToHistory] Phone: 5511999888777
ğŸ“­ [loadConversationHistory] Nenhum histÃ³rico encontrado ou estÃ¡ vazio
ğŸ’¾ [saveToHistory] HistÃ³rico atual: 0 mensagens
ğŸ’¾ [saveToHistory] HistÃ³rico apÃ³s push: 2 mensagens
ğŸ’¾ [saveToHistory] Upsert result: {"error":null,"data":null,"count":null,"status":200,"statusText":"OK"}
ğŸ’¾ [GPT-4] HistÃ³rico salvo com 2 mensagens
   Resposta: "Qual cartÃ£o vocÃª usou para o pagamento?"
   ValidaÃ§Ãµes: Save nÃ£o esperado: âœ…, Perguntou algo esperado: âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 13: "Zul, gastei" â†’ responsÃ¡vel=eu
   Mensagem: "Zul, gastei com pÃ£o no crÃ©dito"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "Zul, gastei com pÃ£o no crÃ©dito"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
âœ… [loadConversationHistory] Carregado: 2 mensagens (state: awaiting_confirmation)
ğŸ“ [extractCollectedInfo] Analisando 1 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: "hoje gastei 50 no mercado no dÃ©bito"
  ğŸ’° Valor encontrado: 50
  ğŸ“„ [EXTRAÃDA] DescriÃ§Ã£o: "hoje 50 mercado" da mensagem: "hoje gastei 50 no mercado no dÃ©bito"
  ğŸ“„ DescriÃ§Ã£o final: Hoje 50 mercado
  ğŸ’³ Pagamento encontrado: dÃ©bito
  ğŸ‘¤ ResponsÃ¡vel: eu
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {"amount":50,"description":"Hoje 50 mercado","payment_method":"dÃ©bito","responsible":"eu"}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 2 mensagens
ğŸ’¬ [GPT-4] Ãšltimas 3 mensagens: [
  {
    "role": "user",
    "content": "hoje gastei 50 no mercado no dÃ©bito"
  },
  {
    "role": "assistant",
    "content": "Qual cartÃ£o vocÃª usou para o pagamento?"
  }
]
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 4
ğŸ’¾ [GPT-4] Salvando no histÃ³rico: user="Zul, gastei com pÃ£o no crÃ©dito", assistant="Quanto foi o valor da despesa?"
ğŸ’¾ [saveToHistory] Phone: 5511999888777
âœ… [loadConversationHistory] Carregado: 2 mensagens (state: awaiting_confirmation)
ğŸ’¾ [saveToHistory] HistÃ³rico atual: 2 mensagens
ğŸ’¾ [saveToHistory] HistÃ³rico apÃ³s push: 4 mensagens
ğŸ’¾ [saveToHistory] Upsert result: {"error":null,"data":null,"count":null,"status":200,"statusText":"OK"}
ğŸ’¾ [GPT-4] HistÃ³rico salvo com 4 mensagens
   Resposta: "Quanto foi o valor da despesa?"
   ValidaÃ§Ãµes: Save nÃ£o esperado: âœ…, Perguntou algo esperado: âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

ğŸ“ Teste 14: Erro transcriÃ§Ã£o "julgastei"
   Mensagem: "julgastei 11,79 com material elÃ©trico no crÃ©dito Latam Ã  vista"
ğŸ“¨ [ZUL] Processando mensagem de Felipe Xavier (7ae77718-a4a2-4a3c-8f99-e537f2c5ff92)
ğŸ“¨ [ZUL] Mensagem: "julgastei 11,79 com material elÃ©trico no crÃ©dito Latam Ã  vista"
ğŸ“¨ [ZUL] Context recebido: {
  "userName": "Felipe Xavier",
  "userId": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "organizationId": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "organizationType": "family",
  "organizationName": "FamÃ­lia Xavier",
  "isSoloUser": false,
  "availableCards": [
    "Latam",
    "C6",
    "Neon",
    "Roxinho",
    "Hub",
    "MercadoPago",
    "XP"
  ]
}
ğŸ“± [ZUL] WhatsApp detectado - usando registrador de despesas
âš ï¸ Context sem saveExpense, adicionando implementaÃ§Ã£o completa
ğŸ’¬ [GPT-4] Iniciando conversa...
âœ… [loadConversationHistory] Carregado: 4 mensagens (state: awaiting_confirmation)
ğŸ“ [extractCollectedInfo] Analisando 2 mensagens do usuÃ¡rio
ğŸ“ [extractCollectedInfo] Texto completo: "hoje gastei 50 no mercado no dÃ©bito zul, gastei com pÃ£o no crÃ©dito"
  ğŸ’° Valor encontrado: 50
  ğŸ“„ [EXTRAÃDA] DescriÃ§Ã£o: "hoje 50 mercado" da mensagem: "hoje gastei 50 no mercado no dÃ©bito"
  ğŸ“„ DescriÃ§Ã£o final: Hoje 50 mercado
  ğŸ’³ Pagamento encontrado: dÃ©bito
  ğŸ‘¤ ResponsÃ¡vel: eu
ğŸ“Š [GPT-4] InformaÃ§Ãµes coletadas: {"amount":50,"description":"Hoje 50 mercado","payment_method":"dÃ©bito","responsible":"eu"}
ğŸ’¬ [GPT-4] HistÃ³rico carregado: 4 mensagens
ğŸ’¬ [GPT-4] Ãšltimas 3 mensagens: [
  {
    "role": "assistant",
    "content": "Qual cartÃ£o vocÃª usou para o pagamento?"
  },
  {
    "role": "user",
    "content": "Zul, gastei com pÃ£o no crÃ©dito"
  },
  {
    "role": "assistant",
    "content": "Quanto foi o valor da despesa?"
  }
]
ğŸ’¬ [GPT-4] Total de mensagens sendo enviadas ao GPT: 6
ğŸ”§ [GPT-4] Function call: save_expense
ğŸ”§ [FUNCTION_CALL] Executing: save_expense
ğŸ’¾ [SAVE] Salvando despesa com args: {
  amount: 11.79,
  description: 'material elÃ©trico',
  payment_method: 'credit_card',
  responsible: 'eu',
  card_name: 'Latam',
  installments: 1
}
ğŸ’¾ [SAVE] Salvando despesa simples com dados: {
  "amount": 11.79,
  "description": "Material eletrico",
  "date": "2025-11-19",
  "category": "Casa",
  "category_id": "e9cb28bc-4247-4d4e-bb33-a2bdd5928511",
  "owner": "Felipe Xavier",
  "cost_center_id": "6b44926c-1b79-4cac-9a82-9f0bc7f15c9e",
  "payment_method": "credit_card",
  "card_id": "eeb7d97a-99a0-4ed5-b7ae-b5d1a2e0735e",
  "organization_id": "9fad4881-65a9-4e38-ad75-b707ddff473f",
  "user_id": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "status": "confirmed",
  "is_shared": false,
  "confirmed_at": "2025-11-20T02:11:16.000Z",
  "confirmed_by": "7ae77718-a4a2-4a3c-8f99-e537f2c5ff92",
  "source": "whatsapp",
  "whatsapp_message_id": "msg_1763604676008"
}
âœ… Despesa salva: 1374
âœ¨ [GPT] Mensagem contextual gerada: Agora sua casa tÃ¡ mais conectada! âš¡ï¸
  -> Result for save_expense: {
  success: true,
  message: 'Joia, tÃ¡ salvo! âœ…\n' +
    'R$ 11,79 - Material eletrico\n' +
    'Casa\n' +
    'CrÃ©dito â€¢ Latam\n' +
    'Felipe Xavier\n' +
    'Hoje\n' +
    '\n' +
    'Agora sua casa tÃ¡ mais conectada! âš¡ï¸',
  expense_id: 1374
}
ğŸ—‘ï¸ [GPT-4] HistÃ³rico limpo
   Resposta: "Joia, tÃ¡ salvo! âœ…
R$ 11,79 - Material eletrico
Casa
CrÃ©dito â€¢ Latam
Felipe Xavier
Hoje

Agora sua casa tÃ¡ mais conectada! âš¡ï¸"
   ValidaÃ§Ãµes: Save esperado: âœ…, ResponsÃ¡vel "felipe": âœ…, NÃƒO perguntou proibido: âœ…
   Resultado: âœ… PASSOU

================================================================================

ğŸ“Š RESULTADO GERAL:

âŒ InferÃªncia de Categoria   25% (1/4)
âœ… MenÃ§Ãµes Diretas           100% (3/3)
âœ… CartÃ£o â†’ CrÃ©dito          100% (2/2)
âœ… Ã€ Vista                   100% (1/1)
âœ… AccentuaÃ§Ã£o               100% (1/1)
âœ… Verbos Individuais        100% (3/3)

--------------------------------------------------------------------------------
ğŸ¯ TOTAL: 79% (11/14) 
================================================================================

